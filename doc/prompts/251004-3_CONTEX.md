Ок, делаем короткое и жёсткое ТЗ под **реальный RTL-SDR** (не файл). 
Цель — пик несущей встанет в **0 Гц**.

# ТЗ: починка Zero-IF для реального RTL

## 1) `beacon406_PSK_FM-plot.py` — передаём IF со **сменой знака** в Soapy-бэкенд

**Почему:** в backends BB-сдвиг делается как `−if_offset_hz`. Сейчас вы даёте отрицательное значение, и в сумме получается **+смещение**, поэтому пик улетает к +37…40 кГц.

Сделайте 2 точечные правки.

**1.1. Место создания бэкенда (startup)**

```diff
- extra_kwargs = {"if_offset_hz": IF_OFFSET_HZ} if (BACKEND_NAME != "file") else {}
+ extra_kwargs = {"if_offset_hz": -IF_OFFSET_HZ} if (BACKEND_NAME != "file") else {}
```

**1.2. Хэндлер переключения бэкенда в UI**

```diff
- extra_kwargs = {"if_offset_hz": IF_OFFSET_HZ} if (name != "file") else {}
+ extra_kwargs = {"if_offset_hz": -IF_OFFSET_HZ} if (name != "file") else {}
```

**1.3. Хэндлер “Открыть файл” (на будущее)**
— для режима `file` не передавать `if_offset_hz` вовсе:

```diff
- extra_kwargs = {"if_offset_hz": IF_OFFSET_HZ}
+ extra_kwargs = {}
```

## 2) `backends.py` — убедиться, что NCO действительно компенсирует IF

(Если уже так — просто проверьте; если нет — правим.)

**2.1. При конфиге SoapyBackend:**

```python
self.if_offset_hz = float(cfg.get("if_offset_hz", 0.0) or 0.0)
self.sample_rate_sps = float(self._sr)
# BB-сдвиг должен быть ровно отрицанием IF:
self._mix_shift_hz = -self.if_offset_hz
self._mix_phase = 0.0
self._mix_w = 2.0*np.pi*self._mix_shift_hz / self.sample_rate_sps if self._mix_shift_hz else 0.0
```

**2.2. В `read()` применять NCO ко всем считанным сэмплам:**

```python
iq = self._read_stream(...)  # как у вас сейчас
if self._mix_w:
    n = np.arange(iq.size, dtype=np.float64)
    osc = np.exp(1j*(self._mix_phase + self._mix_w*n))
    iq = iq * osc
    self._mix_phase = (self._mix_phase + self._mix_w*iq.size) % (2*np.pi)
return iq
```

**2.3. Лог/статус (по желанию, для самоконтроля):**

* печатать строку: `RTL: if_offset_hz=..., bb_shift_hz=... (ожидаем bb_shift_hz = -if_offset_hz)`

## 3) Проверка (acceptance)

1. В `-plot` оставьте ваш текущий `IF_OFFSET_HZ` (например, `-37000` или `-38400`).
2. Запустите RTL-режим.
3. В логах бэкенда должно быть:

   * `if_offset_hz = <ваше значение>`
   * `bb_shift_hz = -if_offset_hz`
4. На спектре пик цели встанет в **0 Гц** (допустимый остаток от CFO RTL ±0.5…2 кГц).
5. (Опционально) Если хотите «в ноль до герца» — после FFT-оценки пика добавьте к `self._mix_w` малую поправку `Δf` (CFO trim).
