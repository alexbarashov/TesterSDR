# ТЗ: Правая панель “Signal Parameters” для `beacon_tester_dsp2web.py`

## 1) Контекст и исходные точки

* В `dsp2web` правая панель сейчас называется **Current** и показывает статус, SDR, FS, CPU и т.д. (таблица в правой колонке HTML шаблона). 
* В полном UI (`beacon_tester_buf-ring_web.py`) правая колонка помечена как **Current** и наполняется параметрами последнего импульса/PSK; лейаут и позиция панели — справа, внутри `.right-panel`. 
* DSP-сервис публикует событие `psk` с уже готовыми метриками: `preamble_ms`, `pos_phase`, `neg_phase`, `rise_us`, `fall_us`, `asymmetry_pct`, `baud`, `hex` и др. — эти поля нужно отобразить. 
* В полном UI уже есть готовое наполнение таблицы Current (см. пример расчётов/форматирования значений). Используем те же наименования и единицы. 

## 2) Цель

Заменить правую панель **Current** в `dsp2web` на панель **Signal Parameters**, отображающую ключевые параметры последнего обнаруженного 406-сообщения/импульса, полученные через `/api/last_pulse` (агрегация `pulse`+`psk` уже есть). 

## 3) Что менять (файлы/узлы)

* Файл: `beacon_tester_dsp2web.py`, HTML-шаблон внутри `HTML_TEMPLATE`. Найти блок правой панели с заголовком “Current” и таблицей статуса. 
* JS-функции в том же шаблоне: `refreshState()`, `loadLastPulse()`, `updateDisplay()`, а также участок, куда рендерится правая колонка (`#statsContent`). 

## 4) Было → Станет

### Было

* Заголовок: **Current**.
* Таблица: `DSP Status`, `SDR Device`, `Sample Rate`, `RMS (dBm)`, `CPU Usage`, далее — “Recent Events”. 

### Станет

* Заголовок: **Signal Parameters**.
* Таблица параметров сигнала 406-PSK (поля и единицы как в полном UI):

  1. **Frequency, kHz** — по данным `freq_hz` (если нет — рассчитывать как 406000 + offset/кГц), формат `xxx.xxx`
  2. **+Phase deviation, rad** — `pos_phase` (радианы, формат `0.00`)
  3. **−Phase deviation, rad** — `neg_phase` (радианы, формат `0.00`)
  4. **Phase time rise, µs** — `rise_us` (формат `0.0`/`0.00`)
  5. **Phase time fall, µs** — `fall_us`
  6. **Power, Wt** — если в ответах есть мощность (иначе оставить `—`/`0.00`)
  7. **Power rise, ms** — из `rise_us` → `ms` (делить на 1000) или брать, если приходит готовое `prise_ms`
  8. **Bit Rate, bps** — `baud` либо производная от `t_mod` (если сервис её не шлёт)
  9. **Asymmetry, %** — `asymmetry_pct`
  10. **CW Preamble, ms** — `preamble_ms`
  11. **Total burst duration, ms** — если есть `length_ms` или пересчёт из оси времени
  12. **Repetition period, s** — если доступно (иначе `—`)

  Набор полей и формат берём по аналогии с полной таблицей `_web` (см. их строки под “406 MHz таблица с реальными значениями в колонке Current”). 

**Важно:** Секция “Recent Events” остаётся ниже таблицы без изменений (как сейчас), но переименовывать не нужно.

## 5) Источник данных и контракт

* Использовать `/api/last_pulse` (уже реализовано — возвращает объединение `pulse` и `psk`). 
* При каждом событии `pulse` или `psk` в SSE — вызывать `loadLastPulse()` для обновления правой панели (это уже делается для графиков, просто дополнить рендер правой таблицы). 
* Поля, которые точно приходят из DSP-сервиса в событии `psk`:
  `preamble_ms`, `baud`, `pos_phase`, `neg_phase`, `rise_us`, `fall_us`, `asymmetry_pct`, `hex` (и т.д.). 

## 6) Форматирование и единицы

* Числа форматировать как в полном UI:

  * Частота в **kHz**: `freq_hz/1000 + 406000` → `xxx.xxx`
  * Фаза, рад: `0.00`
  * Времена rise/fall: **µs** — `0.0`/`0.00`; для **ms** (Power rise) — делить на 1000 → `0.00`
  * Битрейт: `baud` → `0.00`
  * Параметры без значения — показывать `—` (или `0.00`, как в `_web`). 

## 7) Изменения в UI (минимальные)

* Переименовать заголовок правой панели с **Current** на **Signal Parameters** (стили не меняем).
* Заменить содержимое таблицы на перечисленные поля. Сетки/классы CSS — как в текущей `.stats-table`. 

## 8) JS-логика (без кода, поведение)

* Добавить/модифицировать функцию рендера правой таблицы, например `renderSignalParams(data)`, которая:

  * принимает объект из `/api/last_pulse`
  * извлекает и нормализует поля
  * заполняет `#statsContent` новой таблицей параметров
* В `loadLastPulse()` после `updateDisplay(data)` вызвать `renderSignalParams(data)`. 
* В `refreshState()` оставить текущую отрисовку статуса/истории; правую таблицу **параметров сигнала** обновлять только из `/api/last_pulse` (не из `/api/state`), чтобы в таблице были **параметры последнего сообщения**, а не системные статусы.

## 9) Маппинг полей (вход → вывод)

| Входное поле (JSON)                    | Откуда                 | Вывод/единицы                                         |
| -------------------------------------- | ---------------------- | ----------------------------------------------------- |
| `freq_hz` или `Frequency Offset (Hz)`  | `pulse`/резюме сервиса | `Frequency, kHz` = `406000 + offset/1000` → `xxx.xxx` |
| `pos_phase`                            | PSK event              | `+Phase deviation, rad`                               |
| `neg_phase`                            | PSK event              | `−Phase deviation, rad`                               |
| `rise_us`                              | PSK event              | `Phase time rise, µs`                                 |
| `fall_us`                              | PSK event              | `Phase time fall, µs`                                 |
| `asymmetry_pct`                        | PSK event              | `Asymmetry, %`                                        |
| `baud` (или `tmod`→расчёт)             | PSK event              | `Bit Rate, bps`                                       |
| `preamble_ms`                          | PSK event              | `CW Preamble, ms`                                     |
| `length_ms`/ось времени                | Pulse/общие            | `Total burst duration, ms`                            |
| `power_rms_dbm` или `p_wt` (если есть) | сервис/пульс           | `Power, Wt` (или оставить пустым `—`)                 |

(Состав и имена входных полей сверены с событием `psk` и резюме метрик в сервисе.)  

## 10) UX-детали

* Если данных ещё нет (ещё не было импульса) — в таблице показывать “—”/“[no data]”.
* Обновление панели должно происходить сразу после прихода `pulse`/`psk` (SSE), без ручного обновления.
* Историю событий (ниже таблицы) не менять.

## 11) Нефункциональные требования

* Не трогать существующую верстку/стили, использовать текущие классы (`.stats-header`, `.stats-content`, `.stats-table`).
* Не добавлять сторонние зависимости.
* Сохранить существующие эндпоинты и SSE-поток (без изменений).

## 12) Критерии приёмки

1. Заголовок справа — **Signal Parameters** (не “Current”).
2. После первого полученного импульса/PSK таблица справа заполняется числовыми параметрами из `/api/last_pulse`.
3. Значения обновляются на каждом новом импульсе (через SSE).
4. Форматы/единицы совпадают с полным UI `_web` (рад, µs, ms, kHz, bps).
5. При отсутствии значений отображаются “—”/`0.00` по аналогии с `_web`.

## 13) Тест-план (минимум)

* Поднять `beacon_dsp_service.py` и `dsp2web`, убедиться, что события `psk` содержат требуемые поля. 
* Сгенерировать 406-сообщение (или использовать реальный приём), дождаться `psk` → панель заполнена.
* Проверить формат каждой строки таблицы.
* Отключить DSP — таблица остаётся с последними значениями, событие “Disconnected” **не** затирает параметры.

