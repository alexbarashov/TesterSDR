# Claude RUNBOOK — TesterSDR / Beacon Tester Web

Цель: быстрый ежедневный цикл с Claude для проекта **TesterSDR / Beacon Tester Web**: реальный SDR → поток IQ → детектор импульса → метрики → таблицы/графики в вебе. Минимум разговоров, максимум точечных патчей.

## Роли ответов Claude
- **Интегратор** — даёт только точечные вставки кода с якорями и метками `# STRICT_COMPAT`.
- **Тест-инженер** — чек-лист запуска и ожидаемые логи/поля API.
- **Техписатель** — nightly-отчёт и «что завтра».

## Утро (15–25 мин)
1) Открой `doc/prompts/claude/MORNING_CONTEXT.txt` и целиком скормите Claude.
2) Попросите **план на день**: 5–7 задач ≤40 мин, у каждой — критерий «Готово».
3) Попросите таблицу задач (MD): *Задача → Статус → Как проверить → Ссылка/якорь*.
4) Начните с шага №1 (обычно «патч кольцевого буфера/API/графиков»).

## Рабочий цикл (каждая задача ≤40 мин)
- **Мини-бриф:** где правим (файл/функция), риски.
- **Патч:** только вставки/минимальные правки с контекстом ±3 строки, пометки `# STRICT_COMPAT`.
- **Тест:** команды, API-эндпоинты, что должно измениться в UI (таблица/канвас), какие числа ожидаем.
- **Итог:** 3 строки — что изменили, что проверили, что осталось.

## Вечер (10–20 мин)
- Запросите **nightly-отчёт**: изменённые файлы, changelog ≤7 пунктов, команды воспроизведения, контрольные параметры (SR/BW/gain/PPM/BB-shift), 3 маленькие задачи на завтра.
- Зафиксируйте версию/тег в вашем стиле.

## Инварианты
- Всегда используем **фактический** sample rate: `backend.actual_sample_rate_sps`.
- Кольцевой буфер IQ ≥ 3 cек покрывает «посылку 406 мс» и соседние окна.
- Сегменты берём по абсолютным индексам: `[start_abs, end_abs]` из кольца.
- Время в мс: `ms = samples / fs * 1000`.
- Никаких «магических» 1e6 в верхнем коде.

## Мини-шаблоны для запросов Claude

**Патч-вставки**
> «Дай точечные правки к `{file}`. Найди строку “X”, вставь ниже блок. Пометь `# STRICT_COMPAT`. Покажи только изменяемые места с контекстом ±3 строки. После — команды проверки и ожидаемые поля `/api/state` и `/api/last_pulse`.»

**Тест-чеклист**
> «Дай 5–7 пунктов проверки: запуск, клик по кнопкам UI, вызов API, ожидаемые числа (fs, RMS, длина импульса мс), как воспроизвести срабатывание детектора.»
