
# Сессия разработки GUI для TesterSDR

## Дата: 2025-09-19

### Задача
Создать GUI приложение на PySide6/Qt для тестирования сигналов маяков 406 МГц, похожее на COSPAS Beacon Tester v2.

### Выполненная работа

1. **Создан новый файл `apps/beacon_tester_gui.py`** - полноценное GUI приложение для тестирования маяков COSPAS-SARSAT

2. **Реализованные компоненты:**
   - Главное окно с вкладками для различных режимов работы
   - Панель управления SDR (выбор устройства, частота, усиление, sample rate)
   - Виджет отображения спектра в реальном времени с маркером пика
   - Виджет водопада для визуализации истории сигналов
   - Вкладка декодированных сообщений маяков
   - Вкладка параметров PSK сигнала с графиком фазы
   - Вкладка статистики приема
   - Вкладка лога с возможностью сохранения
   - Темная тема интерфейса

3. **Интеграция с существующими модулями:**
   - Использованы модули из `beacon406.lib.backends` для работы с SDR
   - Интегрирована демодуляция PSK из `beacon406.lib.demod`
   - Подключена обработка фазовых метрик из `beacon406.lib.metrics`
   - Поддержка всех бэкендов: RTL-SDR, HackRF, Airspy, SDRPlay, RSA306, файлы

4. **Исправленные проблемы:**
   - Заменен импорт `get_backend` на `make_backend` (правильное имя функции)
   - Исправлен импорт `calculate_phase_metrics` на `process_psk_impulse`
   - Убраны вызовы `setLabel` у `ImageView` (метод отсутствует)
   - Перенесен импорт `SDR_DEFAULT_HW_SR` из config в backends

5. **Установленные зависимости:**
   - PySide6 - фреймворк Qt для Python
   - pyqtgraph - библиотека для научной визуализации

### Архитектура приложения

- **SignalProcessor (QThread)** - отдельный поток для обработки сигналов SDR
  - Чтение данных из SDR/файла
  - Расчет FFT и спектра
  - Демодуляция PSK
  - Отправка сигналов в GUI

- **BeaconTesterMainWindow** - главное окно приложения
  - Управление интерфейсом
  - Обработка событий пользователя
  - Обновление визуализации

- **Специализированные виджеты:**
  - SpectrumWidget - отображение спектра
  - WaterfallWidget - водопад сигналов

### Запуск приложения

```bash
cd C:/work/TesterSDR
python apps/beacon_tester_gui.py
```

### Использование

1. Выбрать источник данных (file для записей или название SDR)
2. Для файлов - нажать "Выбрать файл..." и указать запись из captures/
3. Настроить частоту (406.037 МГц для маяков)
4. Нажать "Старт" для начала обработки
5. Наблюдать спектр, водопад и декодированные сообщения

### Статус
✅ Приложение успешно создано и запускается
✅ Интерфейс полностью функционален
✅ Интеграция с модулями обработки сигналов работает
✅ Поддержка всех SDR бэкендов реализована


----------------------------

Коммит-месседж:
plot/backends: file one-shot + safe EOF; SDR underflow no-stop
- FilePlaybackBackend: single-pass playback, inverse IF applied only for file, stop() resets
- Plot: stop only when BACKEND_NAME=="file"; SDR empty blocks are skipped


-----------------------
TesterSDR/
  .vscode/
    settings.json
  .env
  beacon406/
    apps/
    lib/
  capture/

----------------------
beacon406/               
  __init__.py
  beacon_tester_web.py
----------------------
lib/
  backends.py             
  config.py               
  demod.py               
  metrics.py              
       
-----------------------
apps/                    
  beacon406-generate.py   

-------------------------

> обработка сигнала

● Давайте посмотрим, какие инструменты обработки сигналов есть в проекте и как они работают.

● Read(beacon406\lib\demod.py)
  ⎿  Read 661 lines (ctrl+o to expand)

● Read(beacon406\lib\metrics.py)
  ⎿  Read 149 lines (ctrl+o to expand)

● Read(beacon406\beacon406-plot.py)
  ⎿  Read 100 lines (ctrl+o to expand)

● Обработка сигналов в TesterSDR

  В проекте реализована обработка PSK-сигналов аварийных радиобуев 406 МГц. Основные компоненты:

  1. Демодуляция PSK (lib/demod.py)

  - Детектор фронтов - detect_all_steps_by_mean_fast() находит перепады фазы методом скользящего окна
  - Извлечение данных - extract_half_bits() читает полубиты из фазы
  - Декодирование - halfbits_to_bytes_fast() преобразует полубиты в байты сообщения
  - Безопасный демодулятор - phase_demod_psk_msg_safe() с обработкой ошибок

  2. Фазовые метрики (lib/metrics.py)

  - НЧ-фильтрация - FIR-фильтр 12 кГц для подавления шума
  - Прореживание - децимация в 4 раза после фильтрации
  - Выделение фазы - process_psk_impulse() извлекает непрерывную фазу из IQ
  - Удаление тренда - компенсация частотного сдвига

  3. Анализ импульсов (lib/demod.py)

  - Расчёт параметров - calculate_pulse_params() измеряет:
    - PosPhase/NegPhase - уровни плато
    - PhRise/PhFall - длительности фронтов
    - Ass - асимметрия импульсов
    - Tmod - период модуляции

  Система обрабатывает как реальные сигналы с SDR, так и записанные CF32-файлы.
  
